<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PureLightの自己紹介作成ツール</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5fff8;
      color: #333;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      color: #00c300;
      font-size: 1.5em;
    }
    label {
      display: block;
      margin-top: 1em;
      font-weight: bold;
    }
    label span.required {
      font-size: 0.8em;
      color: red;
      margin-left: 0.5em;
    }
    textarea, input {
      width: 100%;
      padding: 0.5em;
      font-size: 1em;
      margin-top: 0.3em;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    textarea[name="q7"] {
      height: 5em;
    }
    .buttons {
      margin-top: 2em;
      display: flex;
      gap: 1em;
      flex-wrap: wrap;
    }
    button {
      flex: 1 1 auto;
      font-size: 1em;
      padding: 0.7em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #confirmBtn {
      background-color: #00c300;
      color: white;
    }
    #resetBtn {
      background-color: #ccc;
      color: black;
    }
    #copyBtn {
      background-color: #00c300;
      color: white;
      display: none;
    }
    .output {
      white-space: pre-wrap;
      margin-top: 2em;
      padding: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
    }
    .error {
      color: red;
      margin-top: 1em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>PureLightの自己紹介作成ツール</h1>

  <form id="introForm">
    <label>①ライン名（LINEのアカウント名と同じお名前でお願いします）<span class="required">（※必須）</span>
      <input type="text" name="q1" />
    </label>

    <label>②ご家族（ケアラー）自身のお住まいの都道府県（海外の方は国名）<span class="required">（※必須）</span>
      <input type="text" name="q2" />
    </label>

    <label>③当事者からみたあなたの立場<span class="required">（※必須）</span>
      <input type="text" name="q3" />
    </label>

    <label>④当事者の性別<span class="required">（※必須）</span>
      <input type="text" name="q4" />
    </label>

    <label>⑤当事者の年齢（数字だけを入力してください）<span class="required">（※必須）</span>
      <input type="text" name="q5" />
    </label>

    <label>⑥-①発症年齢（数字だけを入力してください）<span class="required">（※必須）</span>
      <input type="text" name="q6_1" />
    </label>

    <label>⑥-②再発回数（数字だけを入力してください。再発歴がない場合は0を入れてください）<span class="required">（※必須）</span>
      <input type="text" name="q6_2" />
    </label>

    <label>⑦発症から現在の状況（ざっくりでも盛り沢山でもOK）悩み、相談、気になっていることなど<span class="required">（※必須）</span>
      <textarea name="q7"></textarea>
    </label>

    <label>⑧現在、過去のお薬歴、サプリ、漢方、栄養療法など<span class="required">（※必須）</span>
      <input type="text" name="q8" />
    </label>

    <label>⑨PureLight内の所属グループ（基本の家族グループ以外）サブグループ、混合グループ
      <input type="text" name="q9" />
    </label>

    <label>⑩所属している地域の家族会（任意）
      <input type="text" name="q10" />
    </label>

    <div class="buttons">
      <button type="button" id="confirmBtn">確認する</button>
      <button type="button" id="resetBtn">やりなおす</button>
      <button type="button" id="copyBtn">LINEに貼り付けるためにコピーする</button>
    </div>

    <div id="error" class="error"></div>
    <div id="output" class="output"></div>
  </form>

  <script>
    const form = document.getElementById("introForm");
    const output = document.getElementById("output");
    const error = document.getElementById("error");
    const copyBtn = document.getElementById("copyBtn");

    const fields = [
      "q1","q2","q3","q4","q5","q6_1","q6_2","q7","q8","q9","q10"
    ];

    const required = ["q1","q2","q3","q4","q5","q6_1","q6_2","q7","q8"];

    const shortLabels = {
      q1: "①ライン名",
      q2: "②お住まいの都道府県/国名",
      q3: "③当事者からみた立場",
      q4: "④当事者の性別",
      q5: "⑤当事者の年齢",
      q6: "⑥発症年齢、再発回数等",
      q7: "⑦現在の状況・悩みなど",
      q8: "⑧お薬歴など",
      q9: "⑨PureLight内の所属グループ",
      q10: "⑩地域の家族会（任意）"
    };

    const storageKey = "purelight_intro";

    window.onload = () => {
      const saved = localStorage.getItem(storageKey);
      if (saved) {
        const data = JSON.parse(saved);
        for (const k of fields) {
          if (data[k]) form[k].value = data[k];
        }
      }
    };

    document.getElementById("confirmBtn").onclick = () => {
      error.textContent = "";
      output.textContent = "";
      copyBtn.style.display = "none";

      const data = {};
      const errors = [];

      for (const k of fields) {
        let val = form[k].value.trim();
        if (["q5", "q6_1", "q6_2"].includes(k)) val = val.replace(/[０-９]/g, s => String.fromCharCode(s.charCodeAt(0) - 65248));
        data[k] = val;
        if (required.includes(k) && !val) {
          if (k === "q6_1") errors.push("⑥-①発症年齢を入力してください。");
          else if (k === "q6_2") errors.push("⑥-②再発回数を入力してください。");
          else errors.push(shortLabels[k] + "を入力してください。");
        }
      }

      if (errors.length) {
        error.textContent = errors.join("\n");
        return;
      }

      localStorage.setItem(storageKey, JSON.stringify(data));

      let intro =
`${shortLabels.q1}
【${data.q1}】

${shortLabels.q2}
【${data.q2}】

${shortLabels.q3}
【${data.q3}】

${shortLabels.q4}
【${data.q4}】

${shortLabels.q5}
【${data.q5}歳】

${shortLabels.q6}
【発症${data.q6_1}歳、${data.q6_2 === "0" ? "再発なし" : "再発" + data.q6_2 + "回"}】

${shortLabels.q7}
【${data.q7}】

${shortLabels.q8}
【${data.q8}】

${shortLabels.q9}
【${data.q9}】

${shortLabels.q10}
【${data.q10}】

❗ご注意❗
完全退会される際はくれぐれも、家族グループ内のノートの削除を忘れないようにしてください。
ノートはご本人でないと削除できません❗`;

      output.textContent = intro;
      copyBtn.style.display = "inline-block";
    };

    document.getElementById("resetBtn").onclick = () => {
      if (confirm("入力内容を消しても良いですか？")) {
        for (const k of fields) form[k].value = "";
        localStorage.removeItem(storageKey);
        output.textContent = "";
        error.textContent = "";
        copyBtn.style.display = "none";
      }
    };

    copyBtn.onclick = async () => {
      try {
        await navigator.clipboard.writeText(output.textContent);
        alert("コピーしました");
      } catch (err) {
        alert("コピーに失敗しました");
      }
    };
  </script>
</body>
</html>
